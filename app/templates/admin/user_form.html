{% extends "base.html" %}

{% block title %}{% if user %}Chỉnh sửa{% else %}Thêm{% endif %} người dùng - Admin{% endblock %}

{% block content %}
<div class="container py-5">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card glass-card">
                <div class="card-header">
                    <h4 class="mb-0">
                        <i class="bi bi-person-{% if user %}gear{% else %}plus{% endif %}"></i>
                        {% if user %}Chỉnh sửa người dùng{% else %}Thêm người dùng mới{% endif %}
                    </h4>
                </div>
                <div class="card-body p-4">
                    <form method="POST"
                        action="{% if user %}{{ url_for('admin.edit_user', user_id=user.id) }}{% else %}{{ url_for('admin.create_user') }}{% endif %}">
                        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />

                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="username" class="form-label">Tên đăng nhập <span
                                        class="text-danger">*</span></label>
                                <input type="text" class="form-control" id="username" name="username"
                                    value="{{ user.username if user else '' }}" required {% if user %}readonly{% endif
                                    %}>
                            </div>

                            {% if not user %}
                            <div class="col-md-6 mb-3">
                                <label for="password" class="form-label">Mật khẩu <span
                                        class="text-danger">*</span></label>
                                <input type="password" class="form-control" id="password" name="password" minlength="8"
                                    required>
                            </div>
                            {% endif %}
                        </div>

                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="full_name" class="form-label">Họ và tên <span
                                        class="text-danger">*</span></label>
                                <input type="text" class="form-control" id="full_name" name="full_name"
                                    value="{{ user.full_name if user else '' }}" required>
                            </div>

                            <div class="col-md-6 mb-3">
                                <label for="email" class="form-label">Email</label>
                                <input type="email" class="form-control" id="email" name="email"
                                    value="{{ user.email if user else '' }}">
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="student_id" class="form-label">Mã sinh viên</label>
                                <input type="text" class="form-control" id="student_id" name="student_id"
                                    value="{{ user.student_id if user else '' }}">
                            </div>

                            <div class="col-md-6 mb-3">
                                <label for="belt" class="form-label">Trình độ</label>
                                <select class="form-select" id="belt" name="belt">
                                    <option value="">Chọn trình độ</option>
                                    {% for belt in ['Kuy 10', 'Kuy 9', 'Kuy 8', 'Kuy 7', 'Kuy 6', 'Kuy 5', 'Kuy 4', 'Kuy
                                    3', 'Kuy 2', 'Kuy 1', 'Đai đen nhất đẳng', 'Đai đen nhị đẳng', 'Đai đen tam đẳng',
                                    'Đai đen tứ đẳng', 'Đai đen ngũ đẳng'] %}
                                    <option value="{{ belt }}" {% if user and user.belt==belt %}selected{% endif %}>
                                        {{ belt }}
                                    </option>
                                    {% endfor %}
                                </select>
                            </div>
                        </div>

                        <!-- Additional Profile Fields -->
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="date_of_birth" class="form-label">Ngày sinh</label>
                                <input type="date" class="form-control" id="date_of_birth" name="date_of_birth"
                                    value="{{ user.date_of_birth.strftime('%Y-%m-%d') if user and user.date_of_birth else '' }}">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="phone_number" class="form-label">Số điện thoại</label>
                                <input type="tel" class="form-control" id="phone_number" name="phone_number"
                                    value="{{ user.phone_number or '' }}" placeholder="+84 ...">
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="facebook_link" class="form-label">Facebook</label>
                                <input type="url" class="form-control" id="facebook_link" name="facebook_link"
                                    value="{{ user.facebook_link or '' }}" placeholder="https://facebook.com/...">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="hometown" class="form-label">Quê quán</label>
                                <input type="text" class="form-control" id="hometown" name="hometown"
                                    value="{{ user.hometown or '' }}" placeholder="Hà Nội, TP HCM...">
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="role" class="form-label">Vai trò <span class="text-danger">*</span></label>
                                <select class="form-select" id="role" name="role" required>
                                    <option value="MEMBER" {% if user and user.role=='MEMBER' %}selected{% elif not user
                                        %}selected{% endif %}>Thành viên</option>
                                    <option value="ADMIN" {% if user and user.role=='ADMIN' %}selected{% endif %}>Quản
                                        trị viên</option>
                                </select>
                            </div>

                            <div class="col-md-6 mb-3">
                                <label for="join_date" class="form-label">Ngày gia nhập</label>
                                <input type="date" class="form-control" id="join_date" name="join_date"
                                    value="{{ user.join_date.strftime('%Y-%m-%d') if user and user.join_date else '' }}">
                            </div>
                        </div>

                        <div class="d-flex gap-2">
                            <button type="submit" class="btn btn-primary">
                                <i class="bi bi-check-circle"></i> {% if user %}Lưu thay đổi{% else %}Tạo người dùng{%
                                endif %}
                            </button>
                            <a href="{{ url_for('admin.users') }}" class="btn btn-secondary">
                                <i class="bi bi-x-circle"></i> Hủy
                            </a>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}