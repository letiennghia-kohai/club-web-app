{% extends "base.html" %}

{% block title %}Hồ sơ của tôi - CLB Karatedo Bách Khoa Hà Nội{% endblock %}

{% block content %}
<div class="container py-5">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card glass-card">
                <div class="card-header">
                    <h4 class="mb-0"><i class="bi bi-person"></i> Chỉnh sửa hồ sơ</h4>
                </div>
                <div class="card-body p-4">
                    <form method="POST" action="{{ url_for('member.profile') }}" enctype="multipart/form-data">
                        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />

                        <!-- Avatar Upload -->
                        <div class="mb-4 text-center">
                            <label class="form-label d-block">Ảnh đại diện</label>
                            <div class="mb-3">
                                {% if current_user.get_avatar_url() %}
                                <img src="{{ current_user.get_avatar_url() }}" alt="Avatar" class="rounded-circle"
                                    style="width: 150px; height: 150px; object-fit: cover;">
                                {% else %}
                                <div class="rounded-circle bg-primary text-white d-inline-flex align-items-center justify-content-center"
                                    style="width: 150px; height: 150px; font-size: 48px; font-weight: bold;">
                                    {{ current_user.get_initials() }}
                                </div>
                                {% endif %}
                            </div>
                            <input type="file" class="form-control w-auto mx-auto" name="avatar" accept="image/*">
                            <div class="form-text">Tối đa 2MB. Ảnh sẽ được resize về 400x400px</div>
                            {% if current_user.get_avatar_url() %}
                            <div class="form-check mt-2">
                                <input class="form-check-input" type="checkbox" name="remove_avatar" value="1"
                                    id="removeAvatar">
                                <label class="form-check-label" for="removeAvatar">
                                    Xóa ảnh đại diện
                                </label>
                            </div>
                            {% endif %}
                        </div>

                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="full_name" class="form-label">Họ và tên <span
                                        class="text-danger">*</span></label>
                                <input type="text" class="form-control" id="full_name" name="full_name"
                                    value="{{ current_user.full_name }}" required>
                            </div>

                            <div class="col-md-6 mb-3">
                                <label for="email" class="form-label">Email</label>
                                <input type="email" class="form-control" id="email" name="email"
                                    value="{{ current_user.email or '' }}">
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="student_id" class="form-label">Mã số sinh viên</label>
                                <input type="text" class="form-control" id="student_id" name="student_id"
                                    value="{{ current_user.student_id or '' }}">
                            </div>

                            <div class="col-md-6 mb-3">
                                <label for="belt" class="form-label">Trình độ</label>
                                <select class="form-select" id="belt" name="belt">
                                    <option value="">Chọn trình độ</option>
                                    {% for belt in ['Kuy 10', 'Kuy 9', 'Kuy 8', 'Kuy 7', 'Kuy 6', 'Kuy 5', 'Kuy 4', 'Kuy
                                    3', 'Kuy 2', 'Kuy 1', 'Đai đen nhất đẳng', 'Đai đen nhị đẳng', 'Đai đen tam đẳng',
                                    'Đai đen tứ đẳng', 'Đai đen ngũ đẳng'] %}
                                    <option value="{{ belt }}" {% if current_user.belt==belt %}selected{% endif %}>
                                        {{ belt }}
                                    </option>
                                    {% endfor %}
                                </select>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label for="join_date" class="form-label">Ngày gia nhập</label>
                            <input type="date" class="form-control" id="join_date" name="join_date"
                                value="{{ current_user.join_date.strftime('%Y-%m-%d') if current_user.join_date else '' }}">
                        </div>

                        <div class="d-flex gap-2">
                            <button type="submit" class="btn btn-primary">
                                <i class="bi bi-check-circle"></i> Lưu thay đổi
                            </button>
                            <a href="{{ url_for('member.dashboard') }}" class="btn btn-secondary">
                                <i class="bi bi-x-circle"></i> Hủy
                            </a>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}